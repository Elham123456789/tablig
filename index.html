/* =======================
   Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø±Ø§Ø³Ù„Ø§Øª
======================= */
#commsPanel{
  position:fixed;
  left:50%;
  transform:translateX(-50%);
  top:10%;
  min-width:min(640px,96vw);
  max-width:96vw;
  background:#fff;
  border:1px solid #e6efec;
  border-radius:14px;
  box-shadow:0 18px 48px rgba(0,0,0,.2);
  padding:0;
  display:none;
  z-index:1800
}
.comms-head{
  display:flex;
  align-items:center;
  justify-content:space-between;
  border-bottom:1px solid #e6efec;
  padding:10px
}
.comms-body{
  padding:12px;
  display:flex;
  flex-direction:column;
  gap:10px
}
.comms-row{
  display:flex;
  gap:8px;
  flex-wrap:wrap;
  align-items:center
}
textarea.comms-preview{
  min-height:200px;
  border:1px dashed #cfe1dd;
  border-radius:10px;
  padding:8px;
  font:inherit;
  white-space:pre-wrap
}

<!-- Ø²Ø± ÙØªØ­ Ø§Ù„Ù…Ø±Ø§Ø³Ù„Ø§Øª -->
<button class="btn-ic tiny" id="btnComms">âœ‰ï¸ Ù…Ø±Ø§Ø³Ù„Ø§Øª</button>

<!-- Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø±Ø§Ø³Ù„Ø§Øª -->
<div id="commsPanel" class="no-print">
  <div class="comms-head">
    <b>Ù…Ø±Ø§Ø³Ù„Ø§Øª</b>
    <button class="ap-close" id="commsClose">âœ•</button>
  </div>

  <div class="comms-body">
    <div class="comms-row">
      <input class="fld" id="mailTo" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ">
      <input class="fld" id="waPhone" placeholder="Ø±Ù‚Ù… ÙˆØ§ØªØ³Ø§Ø¨ Ø¨ØµÙŠØºØ© Ø¯ÙˆÙ„ÙŠØ© (9665xxxxxxx)">
      <button class="inline-pen tiny" id="editDefaults" title="Ø­ÙØ¸ ÙƒØ§ÙØªØ±Ø§Ø¶ÙŠ">âœ</button>
      <button class="btn-ic tiny" id="btnFetchFromDB">ğŸ”„ Ø§Ø³ØªØ¯Ø¹Ø§Ø¡</button>
    </div>

    <textarea id="commsTxt" class="comms-preview"
      placeholder="Ø³ÙŠÙÙˆÙ„Ù‘Ø¯ Ù†Øµ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ù‡Ù†Ø§â€¦"></textarea>

    <div class="comms-row">
      <button class="btn-ic tiny" id="btnMakeComms">ğŸ§  ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø±Ø³Ø§Ù„Ø©</button>
      <button class="btn-ic tiny" id="btnCopyComms">ğŸ“‹ Ù†Ø³Ø®</button>
      <button class="btn-ic tiny" id="btnOpenWA">ğŸŸ¢ ÙØªØ­ ÙˆØ§ØªØ³Ø§Ø¨</button>
      <button class="btn-ic tiny" id="btnOpenMail">âœ‰ï¸ Ø¥Ø±Ø³Ø§Ù„ Ø¨Ø±ÙŠØ¯</button>
    </div>
  </div>
</div>
<script>
const $ = s => document.querySelector(s);

/* ÙØªØ­ / Ø¥ØºÙ„Ø§Ù‚ */
$('#btnComms').onclick = () => {
  $('#commsPanel').style.display = 'block';
  $('#commsTxt').value = composeSummary();
};
$('#commsClose').onclick = () => {
  $('#commsPanel').style.display = 'none';
};

/* Ø­ÙØ¸ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ */
$('#editDefaults').onclick = () => {
  localStorage.setItem('waPhone', ($('#waPhone').value || '').trim());
  localStorage.setItem('mailTo', ($('#mailTo').value || '').trim());
  alert('ØªÙ… Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø±Ø§Ø³Ù„Ø§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©');
};

/* Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ */
$('#btnFetchFromDB').onclick = () => {
  $('#waPhone').value = localStorage.getItem('waPhone') || '9665';
  $('#mailTo').value = localStorage.getItem('mailTo') || '';
};

/* ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ù†Øµ */
function composeSummary(){
return `Ø§Ù„Ø³Ù„Ø§Ù… Ø¹Ù„ÙŠÙƒÙ… ÙˆØ±Ø­Ù…Ø© Ø§Ù„Ù„Ù‡ ÙˆØ¨Ø±ÙƒØ§ØªÙ‡ØŒ

Ù†Ø£Ù…Ù„ Ù…Ù†ÙƒÙ… Ø§Ù„Ø§Ø·Ù„Ø§Ø¹ Ø¹Ù„Ù‰ Ù…Ù„Ø®Øµ Ø§Ù„Ø²ÙŠØ§Ø±Ø© Ø§Ù„ØµÙÙŠØ© ÙˆØ§Ù„ØªÙˆØµÙŠØ§Øª Ø§Ù„Ù…Ø±ÙÙ‚Ø©.

Ø´Ø§ÙƒØ±ÙŠÙ† ÙˆÙ…Ù‚Ø¯Ø±ÙŠÙ† ØªØ¹Ø§ÙˆÙ†ÙƒÙ….

Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø¯Ø±Ø³Ø©`;
}
$('#btnMakeComms').onclick = () => {
  $('#commsTxt').value = composeSummary();
};

/* Ù†Ø³Ø® */
$('#btnCopyComms').onclick = () => {
  $('#commsTxt').select();
  document.execCommand('copy');
  alert('ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø±Ø³Ø§Ù„Ø©');
};

/* ÙˆØ§ØªØ³Ø§Ø¨ */
$('#btnOpenWA').onclick = () => {
  const phone = ($('#waPhone').value || '').replace(/\D+/g,'');
  const text = encodeURIComponent($('#commsTxt').value);
  if(phone) window.open(`https://wa.me/${phone}?text=${text}`,'_blank');
};

/* Ø¨Ø±ÙŠØ¯ */
$('#btnOpenMail').onclick = () => {
  const to = $('#mailTo').value;
  const body = encodeURIComponent($('#commsTxt').value);
  window.location.href = `mailto:${to}?subject=Ù…Ø±Ø§Ø³Ù„Ø© Ù…Ø¯Ø±Ø³ÙŠØ©&body=${body}`;
};
</script>

